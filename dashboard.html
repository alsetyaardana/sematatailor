<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Antrian - Semata Tailor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .filter-btn.active {
            background-color: #1e293b; /* slate-800 */
            color: white;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-4 md:p-8">

    <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        
        <div class="bg-indigo-700 p-6 md:flex md:justify-between md:items-center text-white">
            <div>
                <h1 class="text-2xl font-bold tracking-tight">Data Antrian Semata</h1>
                <p class="text-indigo-200 text-sm mt-1">Pantau progress jahitan secara real-time.</p>
            </div>
            <div class="mt-4 md:mt-0">
                <a href="submit-form.html" class="bg-white text-indigo-700 px-4 py-2 rounded-lg font-semibold hover:bg-indigo-50 transition shadow-sm text-sm">
                    + Input Baru
                </a>
            </div>
        </div>

        <div class="p-5 border-b border-slate-100 flex flex-col md:flex-row gap-4 justify-between bg-white">
            <div class="relative w-full md:w-1/3">
                <input type="text" id="searchInput" class="block w-full px-4 py-2 border border-slate-300 rounded-lg bg-slate-50 focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Cari ID atau Nama...">
                <div class="absolute right-3 top-2.5">
                    <span class="flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500" title="Live Sync"></span>
                    </span>
                </div>
            </div>
            <div class="flex gap-2 overflow-x-auto pb-2 md:pb-0">
                <button onclick="filterStatus('All')" class="filter-btn active px-4 py-1.5 rounded-full border border-slate-200 text-xs font-bold text-slate-600 bg-slate-50 hover:bg-slate-100 transition">Semua</button>
                <button onclick="filterStatus('Proses')" class="filter-btn px-4 py-1.5 rounded-full border border-slate-200 text-xs font-bold text-slate-600 bg-slate-50 hover:bg-slate-100 transition">Proses</button>
                <button onclick="filterStatus('Selesai')" class="filter-btn px-4 py-1.5 rounded-full border border-slate-200 text-xs font-bold text-slate-600 bg-slate-50 hover:bg-slate-100 transition">Selesai</button>
                
                <button onclick="filterStatus('dibatalkan')" class="filter-btn px-4 py-1.5 rounded-full border border-red-100 text-xs font-bold text-red-400 bg-red-50 hover:bg-red-100 transition">Dibatalkan</button>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200">
                <thead class="bg-slate-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">ID Tiket</th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">Pelanggan</th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">Item</th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">Deadline</th>
                        <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase">Status</th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="bg-white divide-y divide-slate-200">
                    <tr><td colspan="5" class="px-6 py-8 text-center text-slate-400">Sedang memuat data...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="bg-slate-50 px-6 py-4 border-t border-slate-200 text-xs text-slate-500 flex justify-between">
            <span>Update otomatis setiap 5 detik</span>
            <span id="lastUpdate">-</span>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è URL PUBLIC API
        const API_URL = "https://semata-n8n.alinktech.my.id/webhook/check-order"; 
        
        let allData = []; 
        let currentFilter = 'All'; 

        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                const json = await response.json();
                
                if (json.data && Array.isArray(json.data)) allData = json.data;
                else if (Array.isArray(json)) allData = json;
                else allData = [];

                applyFilter(); 
                document.getElementById('lastUpdate').innerText = "Last Update: " + new Date().toLocaleTimeString();

            } catch (error) {
                console.error("Sync Error:", error);
            }
        }

        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-8 text-center text-slate-400">Belum ada data antrian.</td></tr>`;
                return;
            }

            data.forEach(item => {
                let badge = 'bg-slate-100 text-slate-600'; 
                if (item.status === 'Proses') badge = 'bg-amber-100 text-amber-800 border border-amber-200';
                if (item.status === 'Selesai') badge = 'bg-emerald-100 text-emerald-800 border border-emerald-200';
                if (item.status === 'Diambil') badge = 'bg-blue-100 text-blue-800 border border-blue-200';
                
                // üî• LOGIC MERAH UNTUK CUSTOMER
                if (item.status.toLowerCase() === 'dibatalkan' || item.status.toLowerCase() === 'batal') {
                    badge = 'bg-red-100 text-red-800 border border-red-200';
                }

                const row = `
                    <tr class="hover:bg-slate-50 transition">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-mono font-medium text-indigo-600">${item.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700">
                            <div class="font-semibold">${item.nama}</div>
                            <div class="text-xs text-slate-400">${item.tgl}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${item.jenis}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${item.deadline}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 rounded-full text-xs font-bold ${badge} capitalize">${item.status}</span>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function applyFilter() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = allData.filter(item => {
                const matchSearch = 
                    item.id.toLowerCase().includes(term) || 
                    item.nama.toLowerCase().includes(term) ||
                    item.jenis.toLowerCase().includes(term);
                
                let matchStatus = false;
                if(currentFilter === 'All') {
                    matchStatus = true;
                } else if(currentFilter === 'dibatalkan') {
                    matchStatus = item.status.toLowerCase() === 'dibatalkan' || item.status.toLowerCase() === 'batal';
                } else {
                    matchStatus = item.status === currentFilter;
                }
                
                return matchSearch && matchStatus;
            });
            renderTable(filtered);
        }

        document.getElementById('searchInput').addEventListener('keyup', applyFilter);

        function filterStatus(status) {
            currentFilter = status;
            
            // Reset Style Tombol
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.className = "filter-btn px-4 py-1.5 rounded-full border text-xs font-bold transition";
                
                if(btn.innerText.toLowerCase().includes('dibatalkan')) {
                     btn.classList.add('border-red-100', 'text-red-400', 'bg-red-50', 'hover:bg-red-100');
                } else {
                     btn.classList.add('border-slate-200', 'text-slate-600', 'bg-slate-50', 'hover:bg-slate-100');
                }
            });

            // Set Style Active Tombol yg diklik
            const clickedBtn = event.currentTarget;
            clickedBtn.className = "filter-btn active px-4 py-1.5 rounded-full border text-xs font-bold transition";
            
            if(status === 'dibatalkan') {
                clickedBtn.classList.add('bg-red-600', 'text-white', 'border-red-600');
            } else {
                clickedBtn.classList.add('bg-slate-800', 'text-white', 'border-slate-800');
            }

            applyFilter();
        }

        fetchData(); 
        setInterval(fetchData, 5000);
    </script>
</body>